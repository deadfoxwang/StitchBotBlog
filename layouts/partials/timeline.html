{{- $timeline := site.Data.timeline_data -}}
{{- if $timeline -}}
  {{- $today := now.Format "2006-01-02" -}}
  {{- $yesterday := (now.AddDate 0 0 -1).Format "2006-01-02" -}}
  {{- $prevDate := "" -}}
  {{- range (sort $timeline "timestamp" "desc") -}}
    {{- $t := time .timestamp -}}
    {{- $dateKey := $t.Format "2006-01-02" -}}
    {{- if ne $dateKey $prevDate -}}
      <div class="timeline-separator">
        {{- if eq $dateKey $today -}}
          今天
        {{- else if eq $dateKey $yesterday -}}
          昨天
        {{- else -}}
          {{ $dateKey }}
        {{- end -}}
      </div>
      {{- $prevDate = $dateKey -}}
    {{- end -}}

    {{- $sourceLabel := .source -}}
    {{- if eq .source "Article" -}}
      {{- $sourceLabel = "posts" -}}
    {{- else if eq .source "Note" -}}
      {{- $sourceLabel = "notes" -}}
    {{- else if eq .source "SystemLog" -}}
      {{- $sourceLabel = "system" -}}
    {{- end -}}

    <article class="timeline-item{{ if .multi_block }} multi-block{{ end }}" data-expandable="true">
      <div class="timeline-meta">
        <span class="type-badge">{{ .content_type }}</span>
        <span class="source-badge">{{ $sourceLabel }}</span>
        <span class="timestamp" title="{{ $t.Format "2006-01-02 15:04:05 -0700" }}" data-timestamp="{{ .timestamp }}">{{ $t.Format "2006-01-02 15:04:05 -0700" }}</span>
        {{- if .multi_block -}}
          <span class="toggle-indicator">▸</span>
        {{- end -}}
      </div>

      <div class="entry-body">
        {{- .body | markdownify -}}
      </div>

      {{- if .tags -}}
      <div class="entry-footer">
        <div class="tags">
          {{- range .tags -}}<span class="pill tag-link">#{{ . }}</span>{{- end -}}
        </div>
        <span class="source-text">source: {{ $sourceLabel }}</span>
      </div>
      {{- end -}}

      <button class="expand-btn" type="button">展开</button>
    </article>
  {{- end -}}
{{- else -}}
  <p class="meta">暂无时间线数据</p>
{{- end -}}
